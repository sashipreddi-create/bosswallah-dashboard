<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BossWallah Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#1A3C6E;--accent:#2E86C1;--green:#27AE60;--red:#E74C3C;--orange:#F39C12;--purple:#8E44AD;--bg:#F5F7FA;--card:#FFF;--text:#2C3E50;--muted:#7F8C8D;--border:#E8EFF8;--adm:#1B2A4A;--adm-acc:#E67E22}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text)}
.sidebar{position:fixed;left:0;top:0;width:260px;height:100vh;background:var(--primary);color:#fff;overflow-y:auto;z-index:100}
.sidebar.admin-mode{background:var(--adm)}
.sidebar .logo{padding:24px 20px;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar .logo h1{font-size:22px;font-weight:800;letter-spacing:1px}
.sidebar .logo .subtitle{font-size:11px;opacity:.6;margin-top:4px}
.sidebar .client-switcher{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar .client-switcher label{font-size:10px;text-transform:uppercase;letter-spacing:1px;opacity:.5;display:block;margin-bottom:6px}
.sidebar .client-switcher select{width:100%;padding:8px 10px;border-radius:6px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.1);color:#fff;font-size:13px;cursor:pointer}
.sidebar .client-switcher select option{background:var(--primary);color:#fff}
.sidebar.admin-mode .client-switcher select option{background:var(--adm)}
.sidebar nav{padding:12px 0}
.sidebar nav .section-label{padding:16px 20px 6px;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;opacity:.4}
.sidebar nav a{display:flex;align-items:center;gap:10px;padding:10px 20px;color:rgba(255,255,255,.7);text-decoration:none;font-size:13px;transition:all .2s;cursor:pointer;border-left:3px solid transparent}
.sidebar nav a:hover{background:rgba(255,255,255,.08);color:#fff}
.sidebar nav a.active{background:rgba(255,255,255,.12);color:#fff;border-left-color:var(--accent)}
.sidebar.admin-mode nav a.active{border-left-color:var(--adm-acc)}
.sidebar nav a .icon{width:18px;text-align:center;font-size:14px}
.sidebar .view-switcher{padding:16px 20px;border-top:1px solid rgba(255,255,255,.1);position:absolute;bottom:0;width:100%;background:rgba(0,0,0,.15)}
.sidebar .view-switcher label{font-size:10px;text-transform:uppercase;letter-spacing:1px;opacity:.5;display:block;margin-bottom:6px}
.view-tabs{display:flex;gap:4px}
.view-tab{flex:1;padding:7px 4px;text-align:center;font-size:11px;border-radius:4px;cursor:pointer;background:rgba(255,255,255,.08);color:rgba(255,255,255,.6);border:none}
.view-tab.active{background:var(--accent);color:#fff}
.view-tab.admin-active{background:var(--adm-acc);color:#fff}
.main{margin-left:260px;padding:24px 32px;min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px}
.topbar h2{font-size:24px;font-weight:700}
.topbar .meta{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.topbar .date-range{padding:8px 14px;border:1px solid var(--border);border-radius:8px;font-size:13px;background:#fff}
.topbar .health-badge{display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:8px;font-size:13px;font-weight:600}
.topbar .health-badge.good{background:#E8F8F0;color:var(--green)}
.topbar .health-badge.warn{background:#FEF5E7;color:var(--orange)}
.btn-primary{background:var(--accent);color:#fff;border:none;padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer}
.btn-outline{background:#fff;color:var(--accent);border:1px solid var(--accent);padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer}
.btn-admin{background:var(--adm-acc);color:#fff;border:none;padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer}
.btn-back{background:none;border:1px solid var(--border);padding:6px 14px;border-radius:6px;font-size:13px;cursor:pointer;color:var(--muted);margin-bottom:16px;display:inline-flex;align-items:center;gap:6px}
.kpi-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:24px}
.kpi-card{background:var(--card);border-radius:12px;padding:20px;border:1px solid var(--border)}
.kpi-card .kpi-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.kpi-card .kpi-value{font-size:28px;font-weight:700;color:var(--primary)}
.kpi-card .kpi-change{font-size:12px;margin-top:4px}
.kpi-card .kpi-change.up{color:var(--green)}
.card{background:var(--card);border-radius:12px;padding:20px;border:1px solid var(--border);margin-bottom:16px}
.card h3{font-size:15px;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.card h3 .badge{font-size:10px;padding:2px 8px;border-radius:10px;font-weight:500}
.card h3 .badge.live{background:#E8F8F0;color:var(--green)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:1200px){.grid-2{grid-template-columns:1fr}}
table{width:100%;border-collapse:collapse;font-size:13px}
table th{text-align:left;padding:10px 12px;font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);border-bottom:2px solid var(--border);font-weight:600}
table td{padding:10px 12px;border-bottom:1px solid var(--border)}
table tr:last-child td{border-bottom:none}
.tag{display:inline-block;padding:3px 8px;border-radius:4px;font-size:11px;font-weight:500}
.tag.green{background:#E8F8F0;color:var(--green)}.tag.blue{background:#EBF5FB;color:var(--accent)}.tag.orange{background:#FEF5E7;color:var(--orange)}.tag.red{background:#FDEDEC;color:var(--red)}.tag.purple{background:#F4ECF7;color:var(--purple)}
.chart-container{position:relative;height:220px;margin-top:8px}
.highlight-card{border-left:4px solid;border-radius:12px;padding:16px 20px;background:#fff;border-top:1px solid var(--border);border-right:1px solid var(--border);border-bottom:1px solid var(--border);margin-bottom:8px}
.highlight-card.positive{border-left-color:var(--green)}.highlight-card.attention{border-left-color:var(--orange)}.highlight-card.action{border-left-color:var(--accent)}
.highlight-card .hl-title{font-size:11px;text-transform:uppercase;letter-spacing:.5px;font-weight:600;margin-bottom:6px}
.highlight-card.positive .hl-title{color:var(--green)}.highlight-card.attention .hl-title{color:var(--orange)}.highlight-card.action .hl-title{color:var(--accent)}
.highlight-card .hl-text{font-size:14px;line-height:1.5}
.activity-item{display:flex;gap:14px;padding:14px 0;border-bottom:1px solid var(--border)}
.activity-item:last-child{border-bottom:none}
.activity-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.activity-icon.done{background:#E8F8F0}.activity-icon.progress{background:#EBF5FB}.activity-icon.review{background:#FEF5E7}.activity-icon.planned{background:#F4ECF7}
.activity-body{flex:1}
.activity-body .activity-title{font-size:14px;font-weight:600;margin-bottom:2px}
.activity-body .activity-detail{font-size:13px;color:var(--muted)}
.activity-meta{text-align:right;flex-shrink:0}
.activity-meta .activity-date{font-size:11px;color:var(--muted)}
.comments-section{border-top:2px solid var(--border);margin-top:24px;padding-top:16px}
.comments-toggle{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;font-weight:600;color:var(--accent);background:none;border:none;padding:8px 0}
.comment-bubble{display:flex;gap:10px;margin-bottom:12px}
.comment-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0}
.comment-avatar.client{background:var(--accent)}.comment-avatar.team{background:var(--primary)}
.comment-body{background:var(--bg);border-radius:8px;padding:10px 14px;flex:1}
.comment-body .comment-meta{font-size:11px;color:var(--muted);margin-bottom:4px}
.comment-body .comment-meta strong{color:var(--text)}
.comment-body .comment-text{font-size:13px;line-height:1.4}
.comment-input-row{display:flex;gap:8px;margin-top:12px}
.comment-input-row input{flex:1;padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-size:13px;outline:none}
.comment-input-row button{padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer}
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);z-index:200;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.modal{background:#fff;border-radius:16px;padding:28px;width:560px;max-width:90vw;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.modal h3{font-size:18px;font-weight:700;margin-bottom:20px}
.modal label{display:block;font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;margin-top:14px}
.modal select,.modal input[type="text"],.modal input[type="email"],.modal input[type="date"],.modal input[type="password"],.modal textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;font-size:13px;outline:none;font-family:inherit}
.modal textarea{min-height:80px;resize:vertical}
.modal .btn-row{display:flex;gap:8px;justify-content:flex-end;margin-top:20px}
.modal .check-row{display:flex;align-items:center;gap:8px;font-size:13px;padding:4px 0}
.modal .check-row input{width:16px;height:16px;accent-color:var(--accent)}
.format-toggle{display:flex;gap:4px;margin-top:6px}
.format-toggle button{flex:1;padding:8px;border:1px solid var(--border);background:#fff;border-radius:6px;font-size:13px;cursor:pointer}
.format-toggle button.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.toast{position:fixed;bottom:24px;right:24px;background:var(--green);color:#fff;padding:14px 24px;border-radius:10px;font-size:14px;font-weight:600;z-index:300;transform:translateY(100px);opacity:0;transition:all .3s ease}
.toast.show{transform:translateY(0);opacity:1}
.multi-select{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.multi-select .ms-option{padding:6px 12px;border:1px solid var(--border);border-radius:6px;font-size:12px;cursor:pointer}
.multi-select .ms-option.selected{background:var(--accent);color:#fff;border-color:var(--accent)}
.agency-client-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
.agency-client-card{background:#fff;border-radius:12px;padding:20px;border:1px solid var(--border);cursor:pointer;transition:all .2s}
.agency-client-card:hover{border-color:var(--accent);box-shadow:0 4px 12px rgba(0,0,0,.08);transform:translateY(-2px)}
.agency-client-card .client-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.agency-client-card .client-name{font-size:16px;font-weight:600}
.agency-client-card .client-type{font-size:12px;color:var(--muted);margin-top:2px}
.agency-client-card .mini-kpis{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.agency-client-card .mini-kpi{font-size:11px;color:var(--muted)}
.agency-client-card .mini-kpi .val{font-size:16px;font-weight:600;color:var(--text);display:block}
.agency-client-card .needs-attention{margin-top:12px;padding:8px 12px;background:#FEF5E7;border-radius:6px;font-size:12px;color:var(--orange)}
.progress-bar{height:8px;border-radius:4px;background:var(--border);overflow:hidden}
.progress-bar .fill{height:100%;border-radius:4px}
.wl-banner{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border-radius:12px;padding:20px 24px;margin-bottom:24px;display:flex;justify-content:space-between;align-items:center}
.wl-banner h3{font-size:16px;font-weight:600}
.wl-banner p{font-size:13px;opacity:.8;margin-top:4px}
.wl-banner .btn{background:#fff;color:var(--primary);padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;border:none;cursor:pointer}
.alert-row{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;margin-bottom:8px;font-size:13px}
.alert-row.warn{background:#FEF5E7}.alert-row.success{background:#E8F8F0}.alert-row.info{background:#EBF5FB}
.admin-badge{display:inline-block;background:var(--adm-acc);color:#fff;font-size:10px;padding:2px 8px;border-radius:4px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.admin-context-bar{background:var(--adm-acc);color:#fff;padding:12px 20px;border-radius:10px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;font-size:14px}
.admin-context-bar strong{font-size:16px}
.client-edit-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;padding:12px;background:var(--bg);border-radius:8px;margin-bottom:12px;align-items:end}
.client-edit-row input{padding:8px 10px;border:1px solid var(--border);border-radius:6px;font-size:12px;width:100%;outline:none}
.client-edit-row label{display:block;font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;margin-bottom:4px}
.client-edit-row button{padding:8px 16px;border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer}
.btn-danger{background:var(--red);color:#fff}
.add-client-form{background:var(--bg);padding:20px;border-radius:12px;border:1px dashed var(--border);margin-top:24px}
.add-client-form h4{font-size:14px;font-weight:600;margin-bottom:16px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:12px}
.form-grid label{display:block;font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;margin-bottom:4px}
.form-grid input,.form-grid select{width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:6px;font-size:12px;outline:none}
.messages-container{display:flex;flex-direction:column;gap:16px}
.message-thread{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border)}
.message-thread h4{font-size:13px;font-weight:600;margin-bottom:12px;color:var(--accent)}
.messages-list{display:flex;flex-direction:column;gap:10px;margin-bottom:12px;max-height:250px;overflow-y:auto}
.reports-container{display:flex;flex-direction:column;gap:16px}
.report-form-inline{background:var(--bg);padding:20px;border-radius:12px;border:1px solid var(--border);margin-bottom:16px}
.recent-reports{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px}
.report-card{background:var(--card);border-radius:8px;padding:16px;border:1px solid var(--border);cursor:pointer}
.report-card:hover{border-color:var(--accent)}
.report-card .report-title{font-size:13px;font-weight:600;margin-bottom:6px}
.report-card .report-date{font-size:11px;color:var(--muted)}
</style>
</head>
<body>
<div class="sidebar" id="sidebar">
  <div class="logo"><h1 id="brandName">BOSSWALLAH</h1><div class="subtitle" id="brandSubtitle">Client Dashboard</div></div>
  <div class="client-switcher" id="clientSwitcher">
    <label id="switcherLabel">Client</label>
    <select id="clientSelect" onchange="onClientSelectChange()"></select>
  </div>
  <nav id="navMenu"></nav>
  <div class="view-switcher">
    <label>Dashboard Mode</label>
    <div class="view-tabs">
      <button class="view-tab active" onclick="switchMode('client')" id="modeClient">Client</button>
      <button class="view-tab" onclick="switchMode('agency')" id="modeAgency">Agency</button>
      <button class="view-tab" onclick="switchMode('admin')" id="modeAdmin">Admin</button>
    </div>
  </div>
</div>
<div class="main" id="mainContent"></div>

<!-- Report Modal -->
<div class="modal-overlay" id="reportModal"><div class="modal">
  <h3>Generate Report</h3>
  <label>Report Type</label><select><option>Weekly Summary</option><option>Monthly Summary</option><option>Business Impact</option><option>Custom</option></select>
  <div style="display:flex;gap:12px"><div style="flex:1"><label>From</label><input type="date" value="2026-02-22"></div><div style="flex:1"><label>To</label><input type="date" value="2026-02-28"></div></div>
  <label>Sections</label>
  <div class="check-row"><input type="checkbox" checked> Weekly Briefing</div>
  <div class="check-row"><input type="checkbox" checked> Content & Production</div>
  <div class="check-row"><input type="checkbox" checked> Business Impact</div>
  <div class="check-row"><input type="checkbox" checked> What's Next</div>
  <label>Format</label>
  <div class="format-toggle"><button class="active" onclick="this.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('active'));this.classList.add('active')">PDF</button><button onclick="this.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('active'));this.classList.add('active')">Excel</button></div>
  <div class="btn-row"><button class="btn-outline" onclick="closeModal('reportModal')">Cancel</button><button class="btn-primary" onclick="closeModal('reportModal');showToast('Report generated!')">Generate</button></div>
</div></div>

<!-- Add User Modal (for client/agency) -->
<div class="modal-overlay" id="addUserModal"><div class="modal">
  <h3 id="addUserTitle">Add Team Member</h3>
  <label>Full Name</label><input type="text" id="newUserName">
  <label>Email</label><input type="email" id="newUserEmail">
  <label>Role</label><select id="newUserRole"><option>Viewer</option><option>Admin</option></select>
  <div id="clientAccessSection" style="display:none"><label>Client Access</label><div class="multi-select" id="clientAccessOptions"></div></div>
  <div class="btn-row"><button class="btn-outline" onclick="closeModal('addUserModal')">Cancel</button><button class="btn-primary" onclick="addUser()">Add</button></div>
</div></div>

<!-- Password Modal -->
<div class="modal-overlay" id="passwordModal"><div class="modal">
  <h3>Change Login Credentials</h3>
  <label>Current Password</label><input type="password"><label>New Password</label><input type="password"><label>Confirm</label><input type="password">
  <div class="btn-row"><button class="btn-outline" onclick="closeModal('passwordModal')">Cancel</button><button class="btn-primary" onclick="closeModal('passwordModal');showToast('Password updated!')">Update</button></div>
</div></div>

<!-- Admin: Add Activity Modal -->
<div class="modal-overlay" id="addActivityModal"><div class="modal">
  <h3>Add Activity</h3>
  <label>Category</label><select id="actCategory"><option value="completed">Completed</option><option value="inProgress">In Progress</option><option value="needsYou">Needs Client Input</option></select>
  <label>Icon</label><select id="actIcon"><option value="üé¨">üé¨ Video</option><option value="‚úçÔ∏è">‚úçÔ∏è Blog</option><option value="üí∞">üí∞ Ads</option><option value="üîç">üîç SEO</option><option value="üìé">üìé LinkedIn</option><option value="‚≠ê">‚≠ê Influencer</option><option value="‚ö†Ô∏è">‚ö†Ô∏è Alert</option></select>
  <label>Title</label><input type="text" id="actTitle" placeholder="e.g. Published: Morning routine video">
  <label>Detail</label><textarea id="actDetail" placeholder="e.g. 142K views, 8.2% engagement"></textarea>
  <label>Date</label><input type="text" id="actDate" placeholder="e.g. Feb 24">
  <div class="btn-row"><button class="btn-outline" onclick="closeModal('addActivityModal')">Cancel</button><button class="btn-admin" onclick="adminAddActivity()">Add</button></div>
</div></div>

<div class="toast" id="toast"></div>

<script>
// ============ DATA ============
const CLIENTS = {
  b2c: {
    name:"GlowUp Beauty",type:"B2C Startup",package:"$5,000/mo",healthScore:87,billing:"direct",lastUpdated:"Feb 28, 2026 ¬∑ 3:45 PM",
    briefing:{weekOf:"Feb 22 ‚Äì 28, 2026",
      completed:[
        {icon:"üé¨",type:"done",title:"Published: ‚ÄúMorning routine reveal‚Äù video",detail:"TikTok, Reels, Shorts ‚Äî 142K views, 8.2% engagement.",date:"Feb 24"},
        {icon:"üé¨",type:"done",title:"Published: ‚ÄúRetinol deep-dive‚Äù video",detail:"TikTok, Reels ‚Äî 67K views, trending up.",date:"Feb 21"},
        {icon:"‚úçÔ∏è",type:"done",title:"Published: ‚ÄúHow to Layer Skincare‚Äù blog",detail:"Ranking #3 ‚Äî 1,800 monthly visits.",date:"Feb 20"},
        {icon:"üí∞",type:"done",title:"Launched Spring Collection ad campaign",detail:"Meta ‚Äî 4.8x ROAS after 5 days.",date:"Feb 23"},
        {icon:"üîç",type:"done",title:"SEO: retinol keyword #8 ‚Üí #4",detail:"3 new backlinks from beauty authority sites.",date:"Feb 22"},
      ],
      inProgress:[
        {icon:"üé¨",type:"progress",title:"Editing: Customer transformation video",detail:"Side-by-side comparison segment. Review Thursday.",date:"Due Feb 28"},
        {icon:"‚≠ê",type:"progress",title:"Finalizing @beautyunfiltered partnership",detail:"120K followers. $800 for 2 posts + 1 reel.",date:"Negotiating"},
        {icon:"üí∞",type:"progress",title:"Testing TikTok Spark Ads",detail:"3.1x ROAS, $18.50 CPA. Monitoring.",date:"Testing"},
      ],
      needsYou:[{icon:"‚ö†Ô∏è",type:"review",title:"Blog ‚ÄúSPF Myths‚Äù needs approval",detail:"Waiting 3 days. Targets 2,400 monthly searches.",date:"Waiting 3d"}],
    },
    content:{
      videos:[
        {title:"Morning routine reveal",status:"Published",platform:"TikTok, Reels, Shorts",result:"142K views",date:"Feb 24"},
        {title:"Retinol deep-dive",status:"Published",platform:"TikTok, Reels",result:"67K views",date:"Feb 21"},
        {title:"Customer transformation",status:"In Editing",platform:"All",result:"Review Thu",date:"Feb 28"},
        {title:"Behind the scenes: Product lab",status:"Scripting",platform:"TikTok, Reels",result:"‚Äî",date:"Mar 3"},
        {title:"Founder Q&A: Clean beauty",status:"Published",platform:"All",result:"52K views",date:"Feb 17"},
        {title:"5 skincare myths debunked",status:"Published",platform:"TikTok, Shorts",result:"98K views",date:"Feb 14"},
        {title:"Valentine's Day gift guide",status:"Published",platform:"Reels, TikTok",result:"73K views",date:"Feb 10"},
        {title:"How to layer products",status:"Published",platform:"All",result:"41K views",date:"Feb 7"},
      ],
      blogs:[
        {title:"Complete Guide to Retinol 2026",status:"Published",result:"3,200/mo",keyword:"best retinol serum 2026"},
        {title:"Clean Beauty: What It Means",status:"Published",result:"2,100/mo",keyword:"clean beauty routine"},
        {title:"How to Layer Skincare",status:"Published",result:"1,800/mo",keyword:"skincare layering order"},
        {title:"SPF Myths",status:"Needs Approval",result:"Target: 2,400/mo",keyword:"sunscreen myths"},
      ],
      summary:{videosDelivered:"8 of 8",blogsDelivered:"3 of 4",socialPosts:"52 across 6 platforms",influencerPosts:"5 from 2 influencers"},
    },
    impact:{
      kpis:[{label:"Total Reach",value:"2.4M",change:"+18%",context:"People who saw your content"},{label:"Leads",value:"1,847",change:"+24%",context:"From all channels"},{label:"Ad ROAS",value:"4.2x",change:"+0.6x",context:"$1 ‚Üí $4.20"},{label:"Organic Traffic",value:"12,400",change:"+22%",context:"Free Google visitors"}],
      channels:[{name:"Instagram",metric:"22.1K",growth:"+1,200",engagement:"4.8%"},{name:"TikTok",metric:"15.4K",growth:"+1,400",engagement:"6.2%"},{name:"YouTube",metric:"3.2K",growth:"+280",engagement:"3.1%"},{name:"Google SEO",metric:"12.4K visits",growth:"+22%",engagement:"8 top-10"},{name:"Paid Ads",metric:"$8,200",growth:"4.2x ROAS",engagement:"$12.80 CPA"}],
      topWins:[{content:"Morning routine (TikTok)",metric:"142K views",impact:"8.2% eng ‚Äî 3x avg"},{content:"Spring Collection ad",metric:"4.8x ROAS",impact:"Recommend scaling 25%"},{content:"Retinol serum (SEO)",metric:"#4 Google",impact:"3,200 free visits/mo"}],
      adBreakdown:[{campaign:"Spring Collection",platform:"Meta",spend:"$3,200",roas:"4.8x",cpa:"$12.40",status:"Active"},{campaign:"Retinol Lookalike",platform:"Meta",spend:"$2,100",roas:"3.9x",cpa:"$15.20",status:"Active"},{campaign:"Brand Search",platform:"Google",spend:"$1,800",roas:"5.2x",cpa:"$8.90",status:"Active"},{campaign:"TikTok Spark",platform:"TikTok",spend:"$1,100",roas:"3.1x",cpa:"$18.50",status:"Testing"}],
      reachTrend:[400,680,1000,1400,2000,2400],leadsTrend:[320,540,780,1100,1490,1847],
    },
    whatsNext:{
      planned:[{icon:"üé¨",title:"2 videos in production",detail:"Product lab (Mar 3), Spring launch (Mar 7)."},{icon:"‚úçÔ∏è",title:"2 blogs queued",detail:"SPF Guide (pending) + Clean Beauty Brands (drafting)."},{icon:"üí∞",title:"Scale Spring ad +25%",detail:"4.8x ROAS. Budget $100 ‚Üí $125/day."},{icon:"‚≠ê",title:"Onboard @beautyunfiltered",detail:"$800 for 2+1. Expected 180K+ reach."},{icon:"üîç",title:"Push retinol to top 3",detail:"2 articles + 5 backlinks."}],
      recommendations:[{title:"Increase TikTok Spark budget",reason:"If 3.1x holds, move $500 from Facebook. Younger audience."},{title:"Launch UGC campaign",reason:"Before/after got 6.1% eng. Invite customer submissions."}],
    },
    account:{admin:"Priya Sharma",email:"priya@glowupbeauty.com",team:[{name:"Priya Sharma",email:"priya@glowupbeauty.com",role:"Admin",status:"Active"}]},
    comments:{
      content:[{avatar:"client",name:"Priya S.",time:"Feb 25, 2:30 PM",text:"Move up retinol video? Launch now March 1st."},{avatar:"team",name:"Raj K.",time:"Feb 25, 3:15 PM",text:"Done. Ready Thursday EOD."}],
      impact:[{avatar:"team",name:"Vikram P.",time:"Feb 23, 2 PM",text:"Spring Collection 4.8x ROAS. Increase 25%?"},{avatar:"client",name:"Priya S.",time:"Feb 23, 3 PM",text:"Go ahead."}],
      next:[{avatar:"team",name:"Anita M.",time:"Feb 24, 10 AM",text:"@beautyunfiltered: $800 for 2+1. Proceed?"},{avatar:"client",name:"Priya S.",time:"Feb 24, 11 AM",text:"Lock it in."}],
    },
    invoices:[
      {id:"INV-2026-006",date:"Feb 1, 2026",amount:"$5,000",status:"Paid",paidDate:"Feb 3, 2026"},
      {id:"INV-2026-005",date:"Jan 1, 2026",amount:"$5,000",status:"Paid",paidDate:"Jan 2, 2026"},
      {id:"INV-2026-004",date:"Dec 1, 2025",amount:"$5,000",status:"Paid",paidDate:"Dec 3, 2025"},
      {id:"INV-2026-003",date:"Nov 1, 2025",amount:"$5,000",status:"Paid",paidDate:"Nov 4, 2025"},
      {id:"INV-2026-002",date:"Oct 1, 2025",amount:"$5,000",status:"Paid",paidDate:"Oct 2, 2025"},
      {id:"INV-2026-001",date:"Sep 1, 2025",amount:"$5,000",status:"Paid",paidDate:"Sep 3, 2025"},
    ],
    bwTeam:{owner:{name:"Raj Kumar",role:"Account Owner"},viewers:[{name:"Anita Mehta",role:"Social Lead"},{name:"Vikram Patel",role:"Ads Lead"},{name:"Deepa Lakshmi",role:"SEO Lead"}]},
  },
  b2b: {
    name:"DataForge AI",type:"B2B Startup",package:"$3,000/mo",healthScore:82,billing:"direct",lastUpdated:"Feb 28, 2026 ¬∑ 2:15 PM",
    briefing:{weekOf:"Feb 22 ‚Äì 28, 2026",
      completed:[
        {icon:"üìé",type:"done",title:"LinkedIn: ETL post went viral",detail:"12.4K impressions, 7.2% eng, 47 ICP comments.",date:"Feb 23"},
        {icon:"üé¨",type:"done",title:"Published: DataForge demo video",detail:"LinkedIn + YouTube ‚Äî 2.1K views.",date:"Feb 20"},
        {icon:"üí∞",type:"done",title:"Retargeting at 4.8x ROAS",detail:"Best campaign, $31 CPA.",date:"Feb 22"},
        {icon:"üîç",type:"done",title:"SEO: ETL alternatives #9 ‚Üí #6",detail:"3 data engineering blog backlinks.",date:"Feb 21"},
        {icon:"‚úçÔ∏è",type:"done",title:"Published: Data Quality ROI blog",detail:"640 visits/mo. Thought leadership.",date:"Feb 19"},
      ],
      inProgress:[
        {icon:"üìé",type:"progress",title:"Drafting 3 LinkedIn posts",detail:"Cost comparison, customer teaser, poll.",date:"Due Mar 1"},
        {icon:"üí∞",type:"progress",title:"Reallocating $300 to retargeting",detail:"Goes live Monday.",date:"In progress"},
      ],
      needsYou:[{icon:"‚ö†Ô∏è",type:"review",title:"Blog ‚ÄúReal-time vs. Batch‚Äù needs review",detail:"1,200/mo keyword. Trending topic.",date:"Waiting 2d"}],
    },
    content:{
      videos:[{title:"DataForge demo: Real-time pipelines",status:"Published",platform:"LinkedIn, YouTube",result:"2.1K views",date:"Feb 20"},{title:"Founder insights: Future of data ops",status:"Published",platform:"LinkedIn, YouTube",result:"1.4K views",date:"Feb 6"}],
      blogs:[{title:"ETL is Dead: Alternatives 2026",status:"Published",result:"1,400/mo",keyword:"etl alternatives"},{title:"Data Pipeline Best Practices",status:"Published",result:"980/mo",keyword:"modern data pipeline"},{title:"Data Quality = ROI",status:"Published",result:"640/mo",keyword:"data quality roi"},{title:"Real-time vs. Batch",status:"Needs Review",result:"Target: 1,200/mo",keyword:"real-time vs batch"}],
      summary:{videosDelivered:"2 of 2",blogsDelivered:"3 of 4",socialPosts:"32 (22 LI, 8 X, 2 YT)",influencerPosts:"N/A (add-on)"},
    },
    impact:{
      kpis:[{label:"Total Reach",value:"340K",change:"+31%",context:"LI, X, YT, Google"},{label:"Qualified Leads",value:"127",change:"+18%",context:"Demos, DMs, forms"},{label:"Ad ROAS",value:"3.8x",change:"+0.4x",context:"LI + Google"},{label:"Organic Traffic",value:"4,800",change:"+28%",context:"Free Google visitors"}],
      channels:[{name:"LinkedIn (Organic)",metric:"4.2K",growth:"+380",engagement:"5.4%"},{name:"LinkedIn (Founder)",metric:"89.2K imp",growth:"+28%",engagement:"14 DMs"},{name:"Google SEO",metric:"4,800 visits",growth:"+28%",engagement:"5 top-10"},{name:"Paid Ads",metric:"$4,500",growth:"3.8x ROAS",engagement:"$47 CPA"}],
      topWins:[{content:"ETL post (LinkedIn)",metric:"12.4K imp",impact:"7.2% eng, ICP comments"},{content:"Retargeting (LI Ads)",metric:"4.8x ROAS",impact:"$31 CPA ‚Äî scaling"},{content:"ETL alternatives (SEO)",metric:"#6 Google",impact:"1,400 free visits/mo"}],
      adBreakdown:[{campaign:"Data Engineers ICP",platform:"LinkedIn",spend:"$2,200",roas:"3.4x",cpa:"$68",status:"Active"},{campaign:"ETL Alternative",platform:"Google",spend:"$1,500",roas:"4.2x",cpa:"$42",status:"Active"},{campaign:"Retargeting",platform:"LinkedIn",spend:"$800",roas:"4.8x",cpa:"$31",status:"Active"}],
      reachTrend:[80,110,140,190,260,340],leadsTrend:[22,38,52,74,108,127],
    },
    linkedin:{profileViews:"2,840",profileViewsChange:"+34%",connections:"1,240",connectionsChange:"+180",icpPercent:"62%",postImpressions:"89,200",postImpressionsChange:"+28%",engagementRate:"5.4%",engagementRateChange:"+0.8%",inboundDMs:14,inboundDMsChange:"+6",
      topPosts:[{text:"Why we stopped using traditional ETL...",impressions:"12,400",engagement:"7.2%",comments:47},{text:"3 data pipeline mistakes that cost $50K...",impressions:"9,800",engagement:"6.8%",comments:31},{text:"Real ROI of data quality (with numbers)...",impressions:"8,100",engagement:"5.9%",comments:24}],
      competitors:[{name:"Competitor A CEO",followers:"3.8K",engagement:"3.2%",postFreq:"2x/wk"},{name:"Competitor B CEO",followers:"2.1K",engagement:"2.8%",postFreq:"1x/wk"},{name:"Your founder",followers:"4.2K",engagement:"5.4%",postFreq:"2x/wk"}]
    },
    whatsNext:{
      planned:[{icon:"üìé",title:"3 LinkedIn posts scheduled",detail:"Cost comparison, customer teaser, poll. Ghostwritten."},{icon:"üé¨",title:"Customer testimonial video",detail:"DataPipe Co interview. 3-min + 60-sec cut."},{icon:"‚úçÔ∏è",title:"Publish Real-time vs. Batch",detail:"Once approved. Adding comparison table."},{icon:"üí∞",title:"Shift $300 to retargeting",detail:"From broad to 4.8x ROAS campaign."},{icon:"üîç",title:"Target featured snippet",detail:"Reformatting ETL blog for position 0."}],
      recommendations:[{title:"Try a LinkedIn poll",reason:"Polls get 2‚Äì3x impressions. 'Biggest pipeline challenge?'"},{title:"Founder's Playbook series",reason:"Deep-dives outperform by 2x. Named series = content flywheel."}],
    },
    account:{admin:"Sarah Chen",email:"sarah@dataforge.ai",team:[{name:"Sarah Chen",email:"sarah@dataforge.ai",role:"Admin",status:"Active"}]},
    comments:{
      content:[{avatar:"client",name:"Sarah C.",time:"Feb 21, 10 AM",text:"Demo was great. 2-min LinkedIn cut?"},{avatar:"team",name:"Raj K.",time:"Feb 21, 11 AM",text:"Ready Monday."}],
      impact:[{avatar:"team",name:"Vikram P.",time:"Feb 22, 1 PM",text:"Retargeting best at 4.8x. Shift $300?"},{avatar:"client",name:"Sarah C.",time:"Feb 22, 2 PM",text:"Agreed."}],
      next:[{avatar:"team",name:"Anita M.",time:"Feb 23, 10 AM",text:"LinkedIn poll: biggest pipeline challenge?"},{avatar:"client",name:"Sarah C.",time:"Feb 23, 11 AM",text:"Love it."}],
      linkedin:[{avatar:"team",name:"Anita M.",time:"Feb 23, 10 AM",text:"Engagement 69% above competitors."},{avatar:"client",name:"Sarah C.",time:"Feb 23, 11 AM",text:"Keep it going."}],
    },
    invoices:[
      {id:"INV-2026-006",date:"Feb 1, 2026",amount:"$3,000",status:"Paid",paidDate:"Feb 2, 2026"},
      {id:"INV-2026-005",date:"Jan 1, 2026",amount:"$3,000",status:"Paid",paidDate:"Jan 3, 2026"},
      {id:"INV-2026-004",date:"Dec 1, 2025",amount:"$3,000",status:"Paid",paidDate:"Dec 2, 2025"},
      {id:"INV-2026-003",date:"Nov 1, 2025",amount:"$3,000",status:"Paid",paidDate:"Nov 3, 2025"},
      {id:"INV-2026-002",date:"Oct 1, 2025",amount:"$3,000",status:"Paid",paidDate:"Oct 1, 2025"},
      {id:"INV-2026-001",date:"Sep 1, 2025",amount:"$3,000",status:"Paid",paidDate:"Sep 2, 2025"},
    ],
    bwTeam:{owner:{name:"Anita Mehta",role:"Account Owner"},viewers:[{name:"Raj Kumar",role:"Video Lead"},{name:"Deepa Lakshmi",role:"SEO Lead"},{name:"Vikram Patel",role:"Ads Lead"}]},
  },
};

const AGENCY = {
  name:"Momentum Digital",
  agencyClients:[
    {id:"freshbowl",name:"FreshBowl",type:"B2C ‚Äî Food",package:"B2C $5K",health:91,reach:"1.8M",leads:"2,340",adSpend:"$6,200",roas:"4.1x",needsAttention:null},
    {id:"novapay",name:"NovaPay",type:"B2B ‚Äî Fintech",package:"B2B $3K",health:78,reach:"180K",leads:"89",adSpend:"$3,800",roas:"3.2x",needsAttention:"SEO traffic -8%"},
    {id:"petvibe",name:"PetVibe",type:"B2C ‚Äî Pets",package:"B2C $5K",health:85,reach:"920K",leads:"1,120",adSpend:"$4,500",roas:"3.8x",needsAttention:null},
    {id:"cloudhr",name:"CloudHR",type:"B2B ‚Äî HR Tech",package:"B2B $3K",health:72,reach:"95K",leads:"42",adSpend:"$2,200",roas:"2.9x",needsAttention:"ROAS below 3x target"},
    {id:"glowup",name:"GlowUp Beauty",type:"B2C ‚Äî Skin",package:"B2C $5K",health:87,reach:"2.4M",leads:"1,847",adSpend:"$8,200",roas:"4.2x",needsAttention:null},
    {id:"dataforge",name:"DataForge AI",type:"B2B ‚Äî Data",package:"B2B $3K",health:82,reach:"340K",leads:"127",adSpend:"$4,500",roas:"3.8x",needsAttention:null},
  ],
  totals:{clients:6,totalRevenue:"$24,000",totalAdManaged:"$29,400",avgHealth:82.5,avgRoas:"3.7x"},
  team:[
    {name:"Alex Rivera",email:"alex@momentumdigital.com",role:"Admin",clients:"All",status:"Active"},
    {name:"Jamie Patel",email:"jamie@momentumdigital.com",role:"Viewer",clients:"FreshBowl, PetVibe",status:"Active"},
    {name:"Morgan Liu",email:"morgan@momentumdigital.com",role:"Admin",clients:"NovaPay, CloudHR",status:"Active"},
    {name:"Dana Kim",email:"dana@momentumdigital.com",role:"Viewer",clients:"All",status:"Invited"},
  ],
  invoices:[
    {id:"AG-2026-006",date:"Feb 1, 2026",amount:"$24,000",detail:"6 clients (3√ó$5K + 3√ó$3K)",status:"Paid",paidDate:"Feb 5, 2026"},
    {id:"AG-2026-005",date:"Jan 1, 2026",amount:"$24,000",detail:"6 clients",status:"Paid",paidDate:"Jan 4, 2026"},
    {id:"AG-2026-004",date:"Dec 1, 2025",amount:"$21,000",detail:"5 clients",status:"Paid",paidDate:"Dec 5, 2025"},
    {id:"AG-2026-003",date:"Nov 1, 2025",amount:"$16,000",detail:"4 clients",status:"Paid",paidDate:"Nov 6, 2025"},
  ],
};

// BW employee roster
const BW_EMPLOYEES = [
  {name:"Raj Kumar",title:"Video & Content Lead"},
  {name:"Anita Mehta",title:"Social Media Lead"},
  {name:"Vikram Patel",title:"Paid Ads Lead"},
  {name:"Deepa Lakshmi",title:"SEO & Content Lead"},
  {name:"Sashi Reddy",title:"Founder & CEO"},
];

// Admin: all accounts (direct + agency)
const ADMIN_ACCOUNTS = [
  {key:'b2c',name:'GlowUp Beauty',type:'Direct ‚Äî B2C',package:'$5,000/mo'},
  {key:'b2b',name:'DataForge AI',type:'Direct ‚Äî B2B',package:'$3,000/mo'},
  {key:'agency_momentum',name:'Momentum Digital',type:'Agency (6 clients)',package:'$24,000/mo'},
];

let currentMode='client',currentClient='b2c',currentSection='briefing',agencyDrillClient=null,adminClient='b2c';
let commentThreads={};
function initComments(){Object.keys(CLIENTS).forEach(k=>{commentThreads[k]={};if(CLIENTS[k].comments)Object.keys(CLIENTS[k].comments).forEach(s=>{commentThreads[k][s]=[...CLIENTS[k].comments[s]]})});}
initComments();

// ============ CLIENT SELECT DROPDOWN ============
function buildClientSelect(){
  const sel=document.getElementById('clientSelect');
  const lbl=document.getElementById('switcherLabel');
  if(currentMode==='client'){
    lbl.textContent='Client';
    sel.innerHTML='<option value="b2c">GlowUp Beauty (B2C)</option><option value="b2b">DataForge AI (B2B)</option>';
    sel.value=currentClient;
  } else if(currentMode==='admin'){
    lbl.textContent='Customer Account';
    sel.innerHTML=ADMIN_ACCOUNTS.map(a=>`<option value="${a.key}">${a.name}</option>`).join('');
    sel.value=adminClient;
  }
  document.getElementById('clientSwitcher').style.display=(currentMode==='client'||currentMode==='admin')?'block':'none';
}
function onClientSelectChange(){
  const v=document.getElementById('clientSelect').value;
  if(currentMode==='client'){currentClient=v;currentSection='briefing';}
  else if(currentMode==='admin'){adminClient=v;currentSection='adm_briefing';}
  renderNav();renderMain();
}

// ============ NAV ============
const NAV={
  client_b2c:[
    {id:'briefing',icon:'üìã',label:"This Week's Briefing",group:'Your Dashboard'},
    {id:'content',icon:'üé¨',label:'Content & Production',group:'Your Dashboard'},
    {id:'impact',icon:'üìà',label:'Business Impact',group:'Your Dashboard'},
    {id:'next',icon:'üöÄ',label:"What's Next",group:'Your Dashboard'},
    {id:'messages',icon:'üí¨',label:'Messages',group:'Communication'},
    {id:'reports',icon:'üìÑ',label:'Reports',group:'Communication'},
    {id:'account',icon:'‚öôÔ∏è',label:'Account',group:'Settings'},
  ],
  client_b2b:[
    {id:'briefing',icon:'üìã',label:"This Week's Briefing",group:'Your Dashboard'},
    {id:'content',icon:'üé¨',label:'Content & Production',group:'Your Dashboard'},
    {id:'impact',icon:'üìà',label:'Business Impact',group:'Your Dashboard'},
    {id:'linkedin',icon:'üìé',label:'LinkedIn Growth Report',group:'Your Dashboard'},
    {id:'next',icon:'üöÄ',label:"What's Next",group:'Your Dashboard'},
    {id:'messages',icon:'üí¨',label:'Messages',group:'Communication'},
    {id:'reports',icon:'üìÑ',label:'Reports',group:'Communication'},
    {id:'account',icon:'‚öôÔ∏è',label:'Account',group:'Settings'},
  ],
  agency:[
    {id:'portfolio',icon:'üè¢',label:'Client Portfolio',group:'Agency'},
    {id:'billing',icon:'üí≥',label:'Billing & Revenue',group:'Agency'},
    {id:'team',icon:'üë•',label:'Team & Access',group:'Agency'},
    {id:'settings',icon:'‚öôÔ∏è',label:'White-Label Settings',group:'Agency'},
  ],
  agency_drill:[
    {id:'briefing',icon:'üìã',label:"Briefing",group:'Client View'},
    {id:'content',icon:'üé¨',label:'Content',group:'Client View'},
    {id:'impact',icon:'üìà',label:'Impact',group:'Client View'},
    {id:'next',icon:'üöÄ',label:"What's Next",group:'Client View'},
    {id:'messages',icon:'üí¨',label:'Messages',group:'Communication'},
    {id:'reports',icon:'üìÑ',label:'Reports',group:'Communication'},
  ],
  admin_client:[
    {id:'adm_briefing',icon:'‚úçÔ∏è',label:'Update Briefing',group:'Dashboard Updates'},
    {id:'adm_metrics',icon:'üìà',label:'Update Metrics',group:'Dashboard Updates'},
    {id:'adm_next',icon:'üöÄ',label:"Plan What's Next",group:'Dashboard Updates'},
    {id:'adm_billing',icon:'üí≥',label:'Billing & Payments',group:'Account'},
    {id:'adm_team',icon:'üë•',label:'BW Team Assignment',group:'Account'},
    {id:'adm_preview',icon:'üëÅÔ∏è',label:'Preview Client View',group:'Account'},
  ],
  admin_agency:[
    {id:'adm_agency_billing',icon:'üí≥',label:'Agency Billing',group:'Agency Account'},
    {id:'adm_agency_clients',icon:'üè¢',label:'Manage Clients',group:'Agency Account'},
  ],
};

function switchMode(mode){
  currentMode=mode;agencyDrillClient=null;
  document.querySelectorAll('.view-tab').forEach(t=>{t.classList.remove('active','admin-active')});
  document.getElementById(mode==='client'?'modeClient':mode==='agency'?'modeAgency':'modeAdmin').classList.add(mode==='admin'?'admin-active':'active');
  document.getElementById('sidebar').classList.toggle('admin-mode',mode==='admin');
  document.getElementById('brandSubtitle').textContent=mode==='admin'?'Admin Console':mode==='agency'?'Agency Dashboard':'Client Dashboard';
  currentSection=mode==='client'?'briefing':mode==='agency'?'portfolio':'adm_briefing';
  buildClientSelect();renderNav();renderMain();
}

function navTo(s){currentSection=s;document.querySelectorAll('.sidebar nav a').forEach(a=>a.classList.remove('active'));document.querySelector(`[data-section="${s}"]`)?.classList.add('active');renderMain();}
function drillIntoClient(cid){agencyDrillClient=cid;currentSection='briefing';renderNav();renderMain();}
function backToPortfolio(){agencyDrillClient=null;currentSection='portfolio';renderNav();renderMain();}

function renderNav(){
  let key,items;
  if(currentMode==='admin'){key=adminClient.startsWith('agency')?'admin_agency':'admin_client';}
  else if(currentMode==='agency'&&agencyDrillClient){key='agency_drill';}
  else if(currentMode==='agency'){key='agency';}
  else{key=`client_${currentClient}`;}
  items=NAV[key]||[];
  let html='',lastG='';
  if(currentMode==='agency'&&agencyDrillClient){
    const cl=AGENCY.agencyClients.find(c=>c.id===agencyDrillClient);
    html+=`<div style="padding:12px 20px;border-bottom:1px solid rgba(255,255,255,.1)"><a onclick="backToPortfolio()" style="cursor:pointer;color:rgba(255,255,255,.5);font-size:12px;display:flex;align-items:center;gap:6px">‚Üê Portfolio</a><div style="color:#fff;font-weight:600;font-size:14px;margin-top:6px">${cl?cl.name:''}</div><div style="font-size:11px;opacity:.5">${cl?cl.type:''}</div></div>`;
  }
  items.forEach(i=>{if(i.group!==lastG){html+=`<div class="section-label">${i.group}</div>`;lastG=i.group;}
    html+=`<a data-section="${i.id}" class="${i.id===currentSection?'active':''}" onclick="navTo('${i.id}')"><span class="icon">${i.icon}</span>${i.label}</a>`;
  });
  document.getElementById('navMenu').innerHTML=html;
}

function healthColor(s){return s>=80?'green':s>=60?'orange':'red'}
function showToast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000)}
function closeModal(id){document.getElementById(id).classList.remove('active')}
function openModal(id){document.getElementById(id).classList.add('active')}

function commentsHTML(sk){
  const ck=currentMode==='agency'&&agencyDrillClient?({glowup:'b2c',dataforge:'b2b'}[agencyDrillClient]||'b2c'):currentClient;
  const threads=commentThreads[ck]?.[sk]||[];const tid=`c_${ck}_${sk}`;
  return `<div class="comments-section"><button class="comments-toggle" onclick="toggleC('${tid}')">üí¨ Messages (${threads.length}) <span id="ar_${tid}" style="font-size:10px">‚ñº</span></button>
  <div id="${tid}" style="display:none;margin-top:12px">${threads.map(c=>`<div class="comment-bubble"><div class="comment-avatar ${c.avatar}">${c.name.charAt(0)}</div><div class="comment-body"><div class="comment-meta"><strong>${c.name}</strong> ¬∑ ${c.time}</div><div class="comment-text">${c.text}</div></div></div>`).join('')}
  <div class="comment-input-row"><input placeholder="Type a message..." id="in_${tid}" onkeypress="if(event.key==='Enter')sendC('${sk}','${tid}','${ck}')"><button onclick="sendC('${sk}','${tid}','${ck}')">Send</button></div></div></div>`;
}
function toggleC(tid){const el=document.getElementById(tid),ar=document.getElementById('ar_'+tid);el.style.display=el.style.display==='none'?'block':'none';ar.textContent=el.style.display==='none'?'‚ñº':'‚ñ≤'}
function sendC(sk,tid,ck){
  const inp=document.getElementById('in_'+tid),txt=inp.value.trim();if(!txt)return;
  if(!commentThreads[ck])commentThreads[ck]={};if(!commentThreads[ck][sk])commentThreads[ck][sk]=[];
  const isAdm=currentMode==='admin',d=CLIENTS[ck];
  commentThreads[ck][sk].push({avatar:isAdm?"team":"client",name:isAdm?"BW Team":(d?.account?.admin||'User').split(' ')[0]+' '+(d?.account?.admin||'U U').split(' ')[1]?.charAt(0)+'.',time:"Just now",text:txt});
  inp.value='';renderMain();
  setTimeout(()=>{const el=document.getElementById(tid);if(el){el.style.display='block';document.getElementById('ar_'+tid).textContent='‚ñ≤'}},50);
}

// ============ RENDER ============
function renderMain(){
  const main=document.getElementById('mainContent');
  if(currentMode==='admin'){renderAdmin(main);return;}
  if(currentMode==='agency'){
    if(agencyDrillClient){
      const map={glowup:'b2c',dataforge:'b2b'};
      if(map[agencyDrillClient]){const d=CLIENTS[map[agencyDrillClient]];currentClient=map[agencyDrillClient];
        switch(currentSection){case 'briefing':renderBriefing(main,d,true);break;case 'content':renderContent(main,d,true);break;case 'impact':renderImpact(main,d,true);break;case 'next':renderNext(main,d,true);break;case 'messages':renderMessages(main,d,true);break;case 'reports':renderReports(main,d,true);break;default:renderBriefing(main,d,true);}
      } else {
        const cl=AGENCY.agencyClients.find(c=>c.id===agencyDrillClient);
        main.innerHTML=`<button class="btn-back" onclick="backToPortfolio()">‚Üê Portfolio</button><div class="topbar"><h2>${cl?.name||''}</h2></div><div class="card"><h3>Dashboard</h3><p style="color:var(--muted)">Full data available for GlowUp Beauty and DataForge AI in this prototype.</p></div>`;
      }
      return;
    }
    renderAgency(main);return;
  }
  const d=CLIENTS[currentClient];
  switch(currentSection){
    case 'briefing':renderBriefing(main,d);break;case 'content':renderContent(main,d);break;
    case 'impact':renderImpact(main,d);break;case 'linkedin':renderLinkedIn(main,d);break;
    case 'next':renderNext(main,d);break;case 'messages':renderMessages(main,d);break;case 'reports':renderReports(main,d);break;case 'account':renderAccount(main,d);break;
    default:renderBriefing(main,d);
  }
}

// ============ CLIENT VIEWS ============
function renderBriefing(el,d,drill){
  const b=d.briefing;
  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Portfolio</button>':''}
    <div class="topbar"><div><h2>This Week's Briefing</h2><span style="font-size:13px;color:var(--muted)">${d.name} ‚Ä¢ ${b.weekOf}</span><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div>
    <div class="meta"><span class="health-badge ${d.healthScore>=80?'good':'warn'}">Health: ${d.healthScore}/100</span></div></div>
    ${b.needsYou.length?`<div style="margin-bottom:24px">${b.needsYou.map(i=>`<div class="highlight-card attention"><div class="hl-title">‚ö†Ô∏è Needs Your Input</div><div class="hl-text"><strong>${i.title}</strong><br>${i.detail}</div></div>`).join('')}</div>`:''}
    <div class="card"><h3>‚úÖ Completed This Week</h3>${b.completed.map(i=>`<div class="activity-item"><div class="activity-icon done">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><div class="activity-date">${i.date}</div><span class="tag green">Done</span></div></div>`).join('')}</div>
    <div class="card"><h3>üîÑ In Progress</h3>${b.inProgress.map(i=>`<div class="activity-item"><div class="activity-icon progress">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><div class="activity-date">${i.date}</div><span class="tag blue">In Progress</span></div></div>`).join('')}</div>`;
}
function renderContent(el,d,drill){
  const c=d.content,st={'Published':'green','In Editing':'orange','Needs Approval':'red','Needs Review':'red','Scripting':'blue'};
  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Back</button>':''}
    <div class="topbar"><div><h2>Content & Production</h2><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div><div class="meta"><span class="date-range">February 2026</span></div></div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Videos</div><div class="kpi-value">${c.summary.videosDelivered}</div></div><div class="kpi-card"><div class="kpi-label">Blogs</div><div class="kpi-value">${c.summary.blogsDelivered}</div></div><div class="kpi-card"><div class="kpi-label">Social</div><div class="kpi-value">${c.summary.socialPosts}</div></div><div class="kpi-card"><div class="kpi-label">Influencer</div><div class="kpi-value">${c.summary.influencerPosts}</div></div></div>
    <div class="card"><h3>Video Pipeline <span class="badge live">Live</span></h3><table><thead><tr><th>Video</th><th>Status</th><th>Platforms</th><th>Result</th><th>Date</th></tr></thead><tbody>${c.videos.map(v=>`<tr><td>${v.title}</td><td><span class="status-dot ${st[v.status]||'blue'}"></span>${v.status}</td><td>${v.platform}</td><td><strong>${v.result}</strong></td><td>${v.date}</td></tr>`).join('')}</tbody></table></div>
    <div class="card"><h3>Blog Posts</h3><table><thead><tr><th>Title</th><th>Status</th><th>Keyword</th><th>Result</th></tr></thead><tbody>${c.blogs.map(b=>`<tr><td>${b.title}</td><td><span class="tag ${st[b.status]||'blue'}">${b.status}</span></td><td>${b.keyword}</td><td>${b.result}</td></tr>`).join('')}</tbody></table></div>`;
}
function renderImpact(el,d,drill){
  const im=d.impact;
  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Back</button>':''}
    <div class="topbar"><div><h2>Business Impact</h2><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div><div class="meta"><span class="date-range">February 2026</span></div></div>
    <div class="kpi-row">${im.kpis.map(k=>`<div class="kpi-card"><div class="kpi-label">${k.label}</div><div class="kpi-value">${k.value}</div><div class="kpi-change up">‚Üë ${k.change}</div><div style="font-size:11px;color:var(--muted);margin-top:4px">${k.context}</div></div>`).join('')}</div>
    <div class="card"><h3>üèÜ Biggest Wins</h3><table><thead><tr><th>Content</th><th>Metric</th><th>Why It Matters</th></tr></thead><tbody>${im.topWins.map(w=>`<tr><td><strong>${w.content}</strong></td><td><span class="tag green">${w.metric}</span></td><td>${w.impact}</td></tr>`).join('')}</tbody></table></div>
    <div class="grid-2"><div class="card"><h3>Channel Growth</h3><table><thead><tr><th>Channel</th><th>Current</th><th>Growth</th><th>Key</th></tr></thead><tbody>${im.channels.map(c=>`<tr><td><strong>${c.name}</strong></td><td>${c.metric}</td><td style="color:var(--green)">${c.growth}</td><td>${c.engagement}</td></tr>`).join('')}</tbody></table></div>
    <div class="card"><h3>Ad Efficiency</h3><table><thead><tr><th>Campaign</th><th>Spend</th><th>ROAS</th><th>CPA</th></tr></thead><tbody>${im.adBreakdown.map(a=>`<tr><td>${a.campaign}</td><td>${a.spend}</td><td><strong>${a.roas}</strong></td><td>${a.cpa}</td></tr>`).join('')}</tbody></table></div></div>
    <div class="grid-2"><div class="card"><h3>Reach (6mo)</h3><div class="chart-container"><canvas id="reachChart"></canvas></div></div><div class="card"><h3>${currentClient==='b2b'?'Lead':'Customer'} Growth</h3><div class="chart-container"><canvas id="leadsChart"></canvas></div></div></div>`;
  setTimeout(()=>{const mo=['Sep','Oct','Nov','Dec','Jan','Feb'];const rc=document.getElementById('reachChart'),lc=document.getElementById('leadsChart');if(rc)new Chart(rc,{type:'line',data:{labels:mo,datasets:[{data:im.reachTrend,borderColor:'#2E86C1',backgroundColor:'rgba(46,134,193,.1)',fill:true,tension:.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});if(lc)new Chart(lc,{type:'bar',data:{labels:mo,datasets:[{data:im.leadsTrend,backgroundColor:'#27AE60',borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}})},100);
}
function renderLinkedIn(el,d){
  if(!d.linkedin)return;const li=d.linkedin;
  el.innerHTML=`<div class="topbar"><div><h2>LinkedIn Growth Report</h2><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div><div class="meta"><span class="tag green">Founder: Sarah Chen</span></div></div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Profile Views</div><div class="kpi-value">${li.profileViews}</div><div class="kpi-change up">‚Üë ${li.profileViewsChange}</div></div><div class="kpi-card"><div class="kpi-label">Connections</div><div class="kpi-value">${li.connections}</div><div class="kpi-change up">‚Üë ${li.connectionsChange}</div></div><div class="kpi-card"><div class="kpi-label">ICP %</div><div class="kpi-value">${li.icpPercent}</div></div><div class="kpi-card"><div class="kpi-label">Impressions</div><div class="kpi-value">${li.postImpressions}</div><div class="kpi-change up">‚Üë ${li.postImpressionsChange}</div></div><div class="kpi-card"><div class="kpi-label">Engagement</div><div class="kpi-value">${li.engagementRate}</div><div class="kpi-change up">‚Üë ${li.engagementRateChange}</div></div><div class="kpi-card"><div class="kpi-label">Inbound DMs</div><div class="kpi-value">${li.inboundDMs}</div><div class="kpi-change up">‚Üë ${li.inboundDMsChange}</div></div></div>
    <div class="grid-2"><div class="card"><h3>Top Posts</h3><table><thead><tr><th>Post</th><th>Imp</th><th>Eng</th><th>Comments</th></tr></thead><tbody>${li.topPosts.map(p=>`<tr><td style="max-width:250px">${p.text}</td><td>${p.impressions}</td><td><strong>${p.engagement}</strong></td><td>${p.comments}</td></tr>`).join('')}</tbody></table></div>
    <div class="card"><h3>vs. Competitors</h3><table><thead><tr><th>Profile</th><th>Followers</th><th>Eng</th><th>Freq</th></tr></thead><tbody>${li.competitors.map(c=>`<tr style="${c.name==='Your founder'?'background:#E8F8F0':''}"><td><strong>${c.name}</strong></td><td>${c.followers}</td><td>${c.engagement}</td><td>${c.postFreq}</td></tr>`).join('')}</tbody></table></div></div>
    <div class="card"><h3>Recommendations</h3><div class="alert-row info">üí° Deep-dives drive 2x engagement.</div><div class="alert-row info">üí° Best window: Tue‚ÄìThu 8‚Äì9am ET.</div><div class="alert-row success">üéØ Engagement 69% above competitors.</div></div>`;
}
function renderNext(el,d,drill){
  const n=d.whatsNext;
  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Back</button>':''}
    <div class="topbar"><div><h2>What's Next</h2><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div><div class="meta"><span class="date-range">March 2026</span></div></div>
    <div class="card"><h3>üìÖ Upcoming Work</h3>${n.planned.map(i=>`<div class="activity-item"><div class="activity-icon planned">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div></div>`).join('')}</div>
    <div class="card"><h3>üí° Our Recommendations</h3>${n.recommendations.map(r=>`<div class="highlight-card action"><div class="hl-title">üí° Recommendation</div><div class="hl-text"><strong>${r.title}</strong><br>${r.reason}</div></div>`).join('')}</div>`;
}

function renderMessages(el,d,drill){
  let allMessages=[];
  const threads=commentThreads[currentClient]||{};
  Object.keys(threads).forEach(key=>{
    if(Array.isArray(threads[key])){
      allMessages=allMessages.concat(threads[key]);
    }
  });
  allMessages.sort((a,b)=>{
    const timeA=a.time==='Just now'?Infinity:(new Date(a.time).getTime()||0);
    const timeB=b.time==='Just now'?Infinity:(new Date(b.time).getTime()||0);
    return timeA-timeB;
  });

  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Back</button>':''}
    <div class="topbar"><div><h2>Messages</h2><span style="font-size:13px;color:var(--muted)">${d.name}</span><div style="font-size:12px;color:var(--muted);margin-top:4px">Last updated: ${d.lastUpdated}</div></div></div>
    <div class="messages-container">
      <div class="message-thread">
        <div class="messages-list">
          ${allMessages.map(c=>`<div class="comment-bubble"><div class="comment-avatar ${c.avatar}">${c.name.charAt(0)}</div><div class="comment-body"><div class="comment-meta"><strong>${c.name}</strong> ¬∑ ${c.time}</div><div class="comment-text">${c.text}</div></div></div>`).join('')}
        </div>
        <div class="comment-input-row">
          <input placeholder="Type a message..." id="msg_input_general" onkeypress="if(event.key==='Enter')sendC('general','msg_input_general','${currentClient}')">
          <button onclick="sendC('general','msg_input_general','${currentClient}')">Send</button>
        </div>
      </div>
    </div>`;
}

function renderReports(el,d,drill){
  el.innerHTML=`${drill?'<button class="btn-back" onclick="backToPortfolio()">‚Üê Back</button>':''}
    <div class="topbar"><h2>Reports</h2><span style="font-size:13px;color:var(--muted)">${d.name}</span></div>
    <div class="reports-container">
      <div class="report-form-inline">
        <h3 style="margin-bottom:16px">Generate Report</h3>
        <div class="form-grid">
          <div>
            <label>Report Type</label>
            <select><option>Weekly Summary</option><option>Monthly Summary</option><option>Business Impact</option><option>Custom</option></select>
          </div>
          <div>
            <label>Format</label>
            <select><option>PDF</option><option>Excel</option></select>
          </div>
        </div>
        <div class="form-grid">
          <div>
            <label>From Date</label>
            <input type="date" value="2026-02-22">
          </div>
          <div>
            <label>To Date</label>
            <input type="date" value="2026-02-28">
          </div>
        </div>
        <div style="margin-bottom:12px">
          <label style="display:block;margin-bottom:8px">Include Sections</label>
          <div class="check-row"><input type="checkbox" checked> Weekly Briefing</div>
          <div class="check-row"><input type="checkbox" checked> Content & Production</div>
          <div class="check-row"><input type="checkbox" checked> Business Impact</div>
          <div class="check-row"><input type="checkbox" checked> What's Next</div>
        </div>
        <button class="btn-primary" onclick="showToast('Report generated! Check your email.')">Generate Report</button>
      </div>

      <h3 style="margin-top:24px;margin-bottom:16px">Recent Reports</h3>
      <div class="recent-reports">
        <div class="report-card">
          <div class="report-title">Weekly Summary</div>
          <div class="report-date">Feb 28, 2026</div>
          <div style="margin-top:10px"><button class="btn-outline" style="font-size:11px;padding:6px 12px">View PDF</button></div>
        </div>
        <div class="report-card">
          <div class="report-title">Monthly Summary</div>
          <div class="report-date">Feb 1, 2026</div>
          <div style="margin-top:10px"><button class="btn-outline" style="font-size:11px;padding:6px 12px">View PDF</button></div>
        </div>
        <div class="report-card">
          <div class="report-title">Business Impact</div>
          <div class="report-date">Jan 31, 2026</div>
          <div style="margin-top:10px"><button class="btn-outline" style="font-size:11px;padding:6px 12px">View PDF</button></div>
        </div>
      </div>
    </div>`;
}

function renderAccount(el,d){
  const t=d.account.team;
  el.innerHTML=`<div class="topbar"><h2>Account</h2></div>
    <div class="grid-2"><div class="card"><h3>Organization</h3><table><tr><td style="width:40%"><strong>Company</strong></td><td>${d.name}</td></tr><tr><td><strong>Package</strong></td><td><span class="tag blue">${d.package}</span></td></tr><tr><td><strong>Admin</strong></td><td>${d.account.admin}</td></tr><tr><td><strong>Email</strong></td><td>${d.account.email}</td></tr></table></div>
    <div class="card"><h3>Login</h3><div class="alert-row info" style="margin-bottom:12px">üîí One login per org.</div><table><tr><td style="width:40%"><strong>Email</strong></td><td>${d.account.email}</td></tr><tr><td><strong>Password</strong></td><td>‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</td></tr></table><div style="margin-top:12px"><button class="btn-primary" onclick="openModal('passwordModal')">üîë Change</button></div></div></div>
    <div class="card"><h3>Team</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th></tr></thead><tbody>${t.map(u=>`<tr><td><strong>${u.name}</strong></td><td>${u.email}</td><td><span class="tag ${u.role==='Admin'?'blue':'green'}">${u.role}</span></td><td><span class="tag green">${u.status}</span></td></tr>`).join('')}</tbody></table>`;
}

function addUser(){
  const nm=document.getElementById('newUserName').value.trim(),em=document.getElementById('newUserEmail').value.trim();if(!nm||!em){showToast('Fill in name and email.');return;}
  if(currentMode==='agency'){AGENCY.team.push({name:nm,email:em,role:document.getElementById('newUserRole').value,clients:'TBD',status:'Invited'});}
  closeModal('addUserModal');showToast(`${nm} invited!`);renderMain();
}

// ============ AGENCY ============
function renderAgency(el){
  switch(currentSection){case 'portfolio':renderPortfolio(el);break;case 'billing':renderAgBilling(el);break;case 'team':renderAgTeam(el);break;case 'settings':renderAgSettings(el);break;default:renderPortfolio(el);}
}
function renderPortfolio(el){
  const ag=AGENCY,att=ag.agencyClients.filter(c=>c.needsAttention);
  el.innerHTML=`<div class="topbar"><h2>Client Portfolio</h2><div class="meta"><span class="health-badge good">${ag.totals.clients} Clients</span></div></div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Revenue</div><div class="kpi-value">${ag.totals.totalRevenue}</div></div><div class="kpi-card"><div class="kpi-label">Ad Managed</div><div class="kpi-value">${ag.totals.totalAdManaged}</div></div><div class="kpi-card"><div class="kpi-label">Avg Health</div><div class="kpi-value">${ag.totals.avgHealth}</div></div><div class="kpi-card"><div class="kpi-label">Avg ROAS</div><div class="kpi-value">${ag.totals.avgRoas}</div></div></div>
    ${att.length?`<div class="card"><h3>‚ö†Ô∏è Needs Attention</h3>${att.map(c=>`<div class="alert-row warn"><strong>${c.name}:</strong>&nbsp;${c.needsAttention}</div>`).join('')}</div>`:''}
    <div class="agency-client-grid">${ag.agencyClients.map(c=>`<div class="agency-client-card" onclick="drillIntoClient('${c.id}')"><div class="client-header"><div><div class="client-name">${c.name}</div><div class="client-type">${c.type} ‚Ä¢ ${c.package}</div></div><span class="tag ${healthColor(c.health)}">${c.health}</span></div><div style="margin-bottom:12px"><div class="progress-bar"><div class="fill" style="width:${c.health}%;background:${c.health>=80?'var(--green)':'var(--orange)'}"></div></div></div><div class="mini-kpis"><div class="mini-kpi"><span class="val">${c.reach}</span>Reach</div><div class="mini-kpi"><span class="val">${c.leads}</span>Leads</div><div class="mini-kpi"><span class="val">${c.adSpend}</span>Ad Spend</div><div class="mini-kpi"><span class="val">${c.roas}</span>ROAS</div></div>${c.needsAttention?`<div class="needs-attention">‚ö†Ô∏è ${c.needsAttention}</div>`:''}</div>`).join('')}</div>`;
}
function renderAgBilling(el){
  el.innerHTML=`<div class="topbar"><h2>Billing & Revenue</h2></div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Revenue</div><div class="kpi-value">${AGENCY.totals.totalRevenue}</div></div><div class="kpi-card"><div class="kpi-label">B2C (3√ó$5K)</div><div class="kpi-value">$15,000</div></div><div class="kpi-card"><div class="kpi-label">B2B (3√ó$3K)</div><div class="kpi-value">$9,000</div></div></div>
    <div class="card"><h3>Billing</h3><table><thead><tr><th>Client</th><th>Package</th><th>Fee</th><th>Status</th><th>Next</th></tr></thead><tbody>${AGENCY.agencyClients.map(c=>`<tr><td><strong>${c.name}</strong></td><td>${c.package}</td><td>${c.package.includes('B2C')?'$5,000':'$3,000'}</td><td><span class="tag green">Paid</span></td><td>Mar 1</td></tr>`).join('')}</tbody></table></div>`;
}
function renderAgTeam(el){
  el.innerHTML=`<div class="topbar"><h2>Team & Access</h2><div class="meta"><button class="btn-primary" onclick="document.getElementById('addUserTitle').textContent='Add Member';document.getElementById('clientAccessSection').style.display='none';openModal('addUserModal')">+ Add</button></div></div>
    <div class="card"><h3>Team</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Access</th><th>Status</th></tr></thead><tbody>${AGENCY.team.map(t=>`<tr><td><strong>${t.name}</strong></td><td>${t.email}</td><td><span class="tag ${t.role==='Admin'?'blue':'green'}">${t.role}</span></td><td>${t.clients}</td><td><span class="tag ${t.status==='Active'?'green':'orange'}">${t.status}</span></td></tr>`).join('')}</tbody></table></div>`;
}
function renderAgSettings(el){
  el.innerHTML=`<div class="topbar"><h2>White-Label Settings</h2></div>
    <div class="wl-banner"><div><h3>Full White-Label Active</h3><p>Clients see your brand only.</p></div><button class="btn">Customize</button></div>
    <div class="grid-2"><div class="card"><h3>Brand</h3><table><tr><td style="width:40%"><strong>Name</strong></td><td>Momentum Digital</td></tr><tr><td><strong>Domain</strong></td><td>dashboard.momentumdigital.com</td></tr><tr><td><strong>Email</strong></td><td>reports@momentumdigital.com</td></tr></table></div>
    <div class="card"><h3>Controls</h3><table><tr><td style="width:40%"><strong>PDF Export</strong></td><td><span class="tag green">On</span></td></tr><tr><td><strong>Auto Reports</strong></td><td><span class="tag green">On</span></td></tr><tr><td><strong>BW Branding</strong></td><td><span class="tag red">Hidden</span></td></tr></table></div></div>`;
}

// ============ ADMIN ============
function admCtx(){
  const a=ADMIN_ACCOUNTS.find(x=>x.key===adminClient);
  return `<div class="admin-context-bar"><div><span class="admin-badge">Updating</span> &nbsp;<strong>${a?.name||''}</strong></div><div style="display:flex;align-items:center;gap:12px"><span>${a?.type||''} ‚Ä¢ ${a?.package||''}</span><button onclick="markUpdated()" style="background:#fff;color:var(--adm-acc);border:none;padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer">‚úì Mark Updated</button></div></div>`;
}
function markUpdated(){
  if(CLIENTS[adminClient]){
    const now=new Date();
    const opts={month:'short',day:'numeric',year:'numeric'};
    const time=now.toLocaleString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
    CLIENTS[adminClient].lastUpdated=now.toLocaleDateString('en-US',opts)+' ¬∑ '+time;
    showToast('Timestamp updated!');
    renderMain();
  }
}

// Admin helper functions
function removeActivity(section,category,idx){
  const d=CLIENTS[adminClient];
  if(section==='briefing'&&d.briefing[category]){
    d.briefing[category].splice(idx,1);
  }
}

function saveAdmMetrics(){
  showToast('Metrics updated!');
  renderMain();
}

function removeNextItem(category,idx){
  const d=CLIENTS[adminClient];
  if(d.whatsNext[category]){
    d.whatsNext[category].splice(idx,1);
  }
}

function addNextItem(category){
  const d=CLIENTS[adminClient];
  if(category==='planned'){
    const icon=document.getElementById('addPlanIcon').value;
    const title=document.getElementById('addPlanTitle').value.trim();
    const detail=document.getElementById('addPlanDetail').value.trim();
    if(title&&detail){
      d.whatsNext.planned.push({icon,title,detail});
      document.getElementById('addPlanTitle').value='';
      document.getElementById('addPlanDetail').value='';
      renderMain();
      showToast('Item added!');
    }
  } else if(category==='recommendations'){
    const title=document.getElementById('addRecTitle').value.trim();
    const reason=document.getElementById('addRecReason').value.trim();
    if(title&&reason){
      d.whatsNext.recommendations.push({title,reason});
      document.getElementById('addRecTitle').value='';
      document.getElementById('addRecReason').value='';
      renderMain();
      showToast('Recommendation added!');
    }
  }
}

function removeViewer(idx){
  const d=CLIENTS[adminClient];
  if(d.bwTeam.viewers){
    d.bwTeam.viewers.splice(idx,1);
  }
}

function addViewer(){
  const d=CLIENTS[adminClient];
  const sel=document.getElementById('addViewerSelect');
  const name=sel.value;
  if(name&&d.bwTeam.viewers){
    const emp=BW_EMPLOYEES.find(e=>e.name===name);
    if(emp&&!d.bwTeam.viewers.find(v=>v.name===name)){
      d.bwTeam.viewers.push({name:emp.name,role:emp.title});
      sel.value='';
      renderMain();
      showToast('Viewer added!');
    }
  }
}

function renderAdmin(el){
  if(adminClient.startsWith('agency')){
    switch(currentSection){
      case 'adm_agency_billing':renderAdmAgencyBilling(el);break;
      case 'adm_agency_clients':renderAdmAgencyClients(el);break;
      default:renderAdmAgencyBilling(el);
    }
  } else {
    const d=CLIENTS[adminClient];
    switch(currentSection){
      case 'adm_briefing':renderAdmBriefing(el,d);break;
      case 'adm_metrics':renderAdmMetrics(el,d);break;
      case 'adm_next':renderAdmNext(el,d);break;
      case 'adm_billing':renderAdmBilling(el,d);break;
      case 'adm_team':renderAdmTeam(el,d);break;
      case 'adm_preview':currentClient=adminClient;renderBriefing(el,d);break;
      default:renderAdmBriefing(el,d);
    }
  }
}

function renderAdmBriefing(el,d){
  const b=d.briefing;
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Update Briefing</h2><button class="btn-admin" onclick="openModal('addActivityModal')" style="margin-left:auto">+ Add Activity</button></div>
    <div class="card"><h3>Needs Client Input</h3>${b.needsYou.map((i,idx)=>`<div class="activity-item"><div class="activity-icon review">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:13px;font-weight:600" onclick="removeActivity('briefing','needsYou',${idx});renderMain()">Remove</button></div></div>`).join('')}</div>
    <div class="card"><h3>‚úÖ Completed</h3>${b.completed.map((i,idx)=>`<div class="activity-item"><div class="activity-icon done">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:13px;font-weight:600" onclick="removeActivity('briefing','completed',${idx});renderMain()">Remove</button></div></div>`).join('')}</div>
    <div class="card"><h3>üîÑ In Progress</h3>${b.inProgress.map((i,idx)=>`<div class="activity-item"><div class="activity-icon progress">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:13px;font-weight:600" onclick="removeActivity('briefing','inProgress',${idx});renderMain()">Remove</button></div></div>`).join('')}</div>`;
}

function renderAdmMetrics(el,d){
  const im=d.impact;
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Update Metrics</h2><button class="btn-admin" style="margin-left:auto" onclick="saveAdmMetrics()">Save All Changes</button></div>
    <div class="card"><h3>KPI Values</h3><table><thead><tr><th>Label</th><th>Value</th><th>Change</th><th>Context</th></tr></thead><tbody>${im.kpis.map((k,idx)=>`<tr><td>${k.label}</td><td><input type="text" value="${k.value}" onchange="CLIENTS['${adminClient}'].impact.kpis[${idx}].value=this.value" style="width:80px"></td><td><input type="text" value="${k.change}" onchange="CLIENTS['${adminClient}'].impact.kpis[${idx}].change=this.value" style="width:80px"></td><td><input type="text" value="${k.context}" onchange="CLIENTS['${adminClient}'].impact.kpis[${idx}].context=this.value" style="width:200px"></td></tr>`).join('')}</tbody></table></div>
    <div class="card"><h3>Health Score</h3><div style="margin:12px 0"><input type="number" min="0" max="100" value="${d.healthScore}" onchange="CLIENTS['${adminClient}'].healthScore=parseInt(this.value)" style="width:80px"> / 100</div></div>
    <div class="card"><h3>Top Wins</h3><table><thead><tr><th>Content</th><th>Metric</th><th>Impact</th></tr></thead><tbody>${im.topWins.map((w,idx)=>`<tr><td><input type="text" value="${w.content}" onchange="CLIENTS['${adminClient}'].impact.topWins[${idx}].content=this.value" style="width:200px"></td><td><input type="text" value="${w.metric}" onchange="CLIENTS['${adminClient}'].impact.topWins[${idx}].metric=this.value" style="width:100px"></td><td><input type="text" value="${w.impact}" onchange="CLIENTS['${adminClient}'].impact.topWins[${idx}].impact=this.value" style="width:200px"></td></tr>`).join('')}</tbody></table></div>`;
}

function renderAdmNext(el,d){
  const n=d.whatsNext;
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Plan What\u2019s Next</h2></div>
    <div class="card"><h3>üìÖ Planned Items</h3>${n.planned.map((i,idx)=>`<div class="activity-item"><div class="activity-icon planned">${i.icon}</div><div class="activity-body"><div class="activity-title">${i.title}</div><div class="activity-detail">${i.detail}</div></div><div class="activity-meta"><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:13px;font-weight:600" onclick="removeNextItem('planned',${idx});renderMain()">Remove</button></div></div>`).join('')}
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)"><div style="font-size:13px;font-weight:600;margin-bottom:12px">Add Planned Item</div><div style="display:grid;gap:8px"><select id="addPlanIcon" style="padding:8px"><option>üé¨</option><option>‚úçÔ∏è</option><option>üí∞</option><option>‚≠ê</option><option>üîç</option></select><input type="text" id="addPlanTitle" placeholder="Title" style="padding:8px"><input type="text" id="addPlanDetail" placeholder="Detail" style="padding:8px"><button class="btn-admin" onclick="addNextItem('planned')">Add</button></div></div></div>
    <div class="card"><h3>üí° Recommendations</h3>${n.recommendations.map((r,idx)=>`<div class="activity-item"><div class="activity-body"><div class="activity-title">${r.title}</div><div class="activity-detail">${r.reason}</div></div><div class="activity-meta"><button style="background:none;border:none;color:var(--red);cursor:pointer;font-size:13px;font-weight:600" onclick="removeNextItem('recommendations',${idx});renderMain()">Remove</button></div></div>`).join('')}
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)"><div style="font-size:13px;font-weight:600;margin-bottom:12px">Add Recommendation</div><div style="display:grid;gap:8px"><input type="text" id="addRecTitle" placeholder="Title" style="padding:8px"><input type="text" id="addRecReason" placeholder="Reason" style="padding:8px"><button class="btn-admin" onclick="addNextItem('recommendations')">Add</button></div></div></div>`;
}

function renderAdmBilling(el,d){
  const inv=d.invoices||[];
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Billing & Payments</h2></div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Monthly Fee</div><div class="kpi-value">${d.package}</div></div><div class="kpi-card"><div class="kpi-label">Billing Type</div><div class="kpi-value">Direct</div></div><div class="kpi-card"><div class="kpi-label">Total Collected</div><div class="kpi-value">$${inv.reduce((s,x)=>s+parseInt(x.amount.replace(/[^0-9]/g,'')),0).toLocaleString()}</div></div><div class="kpi-card"><div class="kpi-label">Payment Status</div><div class="kpi-value"><span class="tag green">Current</span></div></div></div>
    <div class="card"><h3>Invoice History</h3><table><thead><tr><th>Invoice</th><th>Date</th><th>Amount</th><th>Status</th><th>Paid</th></tr></thead><tbody>${inv.map(x=>`<tr><td><strong>${x.id}</strong></td><td>${x.date}</td><td>${x.amount}</td><td><span class="tag green">${x.status}</span></td><td>${x.paidDate}</td></tr>`).join('')}</tbody></table></div>`;
}

function renderAdmTeam(el,d){
  const owner=d.bwTeam.owner;
  const viewers=d.bwTeam.viewers||[];
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>BossWallah Team Assignment</h2></div>
    <div class="alert-row info" style="margin-bottom:20px">‚ÑπÔ∏è One owner per customer.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
      <div class="card"><h3>Account Owner</h3><div style="margin:12px 0"><div style="font-size:12px;color:var(--muted);margin-bottom:6px">Current Owner</div><div style="margin-bottom:12px"><strong>${owner.name}</strong></div><select id="ownerSelect" onchange="CLIENTS['${adminClient}'].bwTeam.owner.name=this.options[this.selectedIndex].text;renderMain()" style="padding:8px;width:100%"><option>${owner.name}</option>${BW_EMPLOYEES.filter(e=>e.name!==owner.name).map(e=>`<option>${e.name}</option>`).join('')}</select></div></div>
      <div class="card"><h3>Viewers</h3><div style="margin:12px 0"><table style="width:100%"><thead><tr><th>Name</th><th>Action</th></tr></thead><tbody>${viewers.map((v,idx)=>`<tr><td>${v.name}</td><td><button style="background:none;border:none;color:var(--red);cursor:pointer;font-weight:600;font-size:11px" onclick="removeViewer(${idx});renderMain()">Remove</button></td></tr>`).join('')}</tbody></table><div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)"><select id="addViewerSelect" style="padding:8px;width:100%;margin-bottom:8px"><option value="">Add viewer...</option>${BW_EMPLOYEES.filter(e=>e.name!==owner.name&&!viewers.find(v=>v.name===e.name)).map(e=>`<option value="${e.name}">${e.name}</option>`).join('')}</select><button class="btn-admin" onclick="addViewer()" style="width:100%">Add</button></div></div></div>
    </div>`;
}

function renderAdmAgencyBilling(el){
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Agency Billing</h2></div>
    <div class="alert-row info" style="margin-bottom:20px">üí≥ Momentum Digital's end clients pay the agency directly. BossWallah invoices the agency for all managed clients.</div>
    <div class="kpi-row"><div class="kpi-card"><div class="kpi-label">Monthly Invoice</div><div class="kpi-value">${AGENCY.totals.totalRevenue}</div></div><div class="kpi-card"><div class="kpi-label">Clients Managed</div><div class="kpi-value">${AGENCY.totals.clients}</div></div><div class="kpi-card"><div class="kpi-label">B2C Revenue</div><div class="kpi-value">$15,000</div><div class="kpi-change">3 √ó $5,000</div></div><div class="kpi-card"><div class="kpi-label">B2B Revenue</div><div class="kpi-value">$9,000</div><div class="kpi-change">3 √ó $3,000</div></div></div>
    <div class="card"><h3>Revenue by Client</h3><table><thead><tr><th>Client</th><th>Package</th><th>BW Fee</th><th>Note</th></tr></thead><tbody>${AGENCY.agencyClients.map(c=>`<tr><td><strong>${c.name}</strong></td><td>${c.package}</td><td>${c.package.includes('B2C')?'$5,000':'$3,000'}</td><td style="color:var(--muted)">Agency billed</td></tr>`).join('')}</tbody></table></div>
    <div class="card"><h3>Invoice History (BW ‚Üí Momentum Digital)</h3><table><thead><tr><th>Invoice</th><th>Date</th><th>Amount</th><th>Detail</th><th>Status</th><th>Paid</th></tr></thead><tbody>${AGENCY.invoices.map(inv=>`<tr><td><strong>${inv.id}</strong></td><td>${inv.date}</td><td>${inv.amount}</td><td>${inv.detail}</td><td><span class="tag green">${inv.status}</span></td><td>${inv.paidDate}</td></tr>`).join('')}</tbody></table></div>`;
}

function recalcAgencyTotals(){
  AGENCY.totals.clients=AGENCY.agencyClients.length;
  AGENCY.totals.avgHealth=(AGENCY.agencyClients.reduce((s,c)=>s+c.health,0)/AGENCY.agencyClients.length).toFixed(1);
  const b2cRevenue=AGENCY.agencyClients.filter(c=>c.type.includes('B2C')).length*5000;
  const b2bRevenue=AGENCY.agencyClients.filter(c=>c.type.includes('B2B')).length*3000;
  AGENCY.totals.totalRevenue='$'+(b2cRevenue+b2bRevenue).toLocaleString();
  AGENCY.totals.totalAdManaged='$'+AGENCY.agencyClients.reduce((s,c)=>s+parseInt(c.adSpend.replace(/[^0-9]/g,'')),0).toLocaleString();
  const avgRoas=AGENCY.agencyClients.reduce((s,c)=>s+parseFloat(c.roas),0)/AGENCY.agencyClients.length;
  AGENCY.totals.avgRoas=avgRoas.toFixed(1)+'x';
}

function removeAgencyClient(id){
  const idx=AGENCY.agencyClients.findIndex(c=>c.id===id);
  if(idx>-1){
    AGENCY.agencyClients.splice(idx,1);
    recalcAgencyTotals();
    renderMain();
    showToast('Client removed');
  }
}

function addAgencyClient(){
  const name=document.getElementById('newClientName').value.trim();
  const type=document.getElementById('newClientType').value;
  const health=parseInt(document.getElementById('newClientHealth').value)||80;
  const reach=document.getElementById('newClientReach').value.trim()||'0K';
  const leads=document.getElementById('newClientLeads').value.trim()||'0';
  const adSpend=document.getElementById('newClientAdSpend').value.trim()||'$0';
  const roas=document.getElementById('newClientRoas').value.trim()||'0x';

  if(!name){showToast('Please enter client name');return;}

  const id=name.toLowerCase().replace(/\s+/g,'');
  const pkg=type==='B2C'?'B2C $5K':'B2B $3K';

  AGENCY.agencyClients.push({
    id,name,type:`B2${type.slice(-1)} ‚Äî ${name}`,package:pkg,health,reach,leads,adSpend,roas,needsAttention:null
  });

  recalcAgencyTotals();
  document.getElementById('newClientName').value='';
  document.getElementById('newClientReach').value='';
  document.getElementById('newClientLeads').value='';
  document.getElementById('newClientAdSpend').value='';
  document.getElementById('newClientRoas').value='';
  renderMain();
  showToast('Client added');
}

function updateAgencyClientField(id,field,value){
  const client=AGENCY.agencyClients.find(c=>c.id===id);
  if(client){
    client[field]=value;
    if(['health','adSpend','roas'].includes(field)){recalcAgencyTotals();}
  }
}

function renderAdmAgencyClients(el){
  el.innerHTML=`${admCtx()}
    <div class="topbar"><h2>Manage Clients</h2></div>
    <div class="card">
      <h3>Clients Under Momentum Digital</h3>
      <table>
        <thead>
          <tr>
            <th>Client</th>
            <th>Type</th>
            <th>Health</th>
            <th>Reach</th>
            <th>Leads</th>
            <th>Ad Spend</th>
            <th>ROAS</th>
            <th>Needs Attention</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          ${AGENCY.agencyClients.map(c=>`
            <tr>
              <td><strong>${c.name}</strong></td>
              <td>${c.type}</td>
              <td>
                <input type="number" value="${c.health}" min="0" max="100" style="width:50px"
                  onchange="updateAgencyClientField('${c.id}','health',parseInt(this.value));renderMain()">
              </td>
              <td>
                <input type="text" value="${c.reach}" style="width:70px"
                  onchange="updateAgencyClientField('${c.id}','reach',this.value)">
              </td>
              <td>
                <input type="text" value="${c.leads}" style="width:70px"
                  onchange="updateAgencyClientField('${c.id}','leads',this.value)">
              </td>
              <td>
                <input type="text" value="${c.adSpend}" style="width:80px"
                  onchange="updateAgencyClientField('${c.id}','adSpend',this.value);renderMain()">
              </td>
              <td>
                <input type="text" value="${c.roas}" style="width:60px"
                  onchange="updateAgencyClientField('${c.id}','roas',this.value);renderMain()">
              </td>
              <td>
                <input type="text" placeholder="Note" value="${c.needsAttention||''}" style="width:150px"
                  onchange="updateAgencyClientField('${c.id}','needsAttention',this.value||null)">
              </td>
              <td>
                <button class="btn-danger" style="padding:4px 10px;font-size:11px" onclick="removeAgencyClient('${c.id}')">Remove</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>

    <div class="add-client-form">
      <h4>Add New Client</h4>
      <div class="form-grid">
        <div>
          <label>Client Name</label>
          <input type="text" id="newClientName" placeholder="e.g. TechStartup">
        </div>
        <div>
          <label>Type</label>
          <select id="newClientType">
            <option value="B2C">B2C</option>
            <option value="B2B">B2B</option>
          </select>
        </div>
        <div>
          <label>Health Score (0-100)</label>
          <input type="number" id="newClientHealth" value="80" min="0" max="100">
        </div>
        <div>
          <label>Reach</label>
          <input type="text" id="newClientReach" placeholder="e.g. 500K">
        </div>
        <div>
          <label>Leads</label>
          <input type="text" id="newClientLeads" placeholder="e.g. 150">
        </div>
        <div>
          <label>Ad Spend</label>
          <input type="text" id="newClientAdSpend" placeholder="e.g. $5,000">
        </div>
        <div>
          <label>ROAS</label>
          <input type="text" id="newClientRoas" placeholder="e.g. 3.5x">
        </div>
      </div>
      <button class="btn-primary" onclick="addAgencyClient()">+ Add Client</button>
    </div>`;
}

// ============ INIT ============
buildClientSelect();renderNav();renderMain();
</script>
</body>
</html>
